{% extends 'base.html' %}
{% load static %}

{% block title %}
Movie List
{% endblock %}

{% block css_styles %}
    <style>
      .card-img-top { aspect-ratio: 2/3; object-fit: cover; }
    </style>
{% endblock %}

{% block content %}

    {% comment top_movies_big_ver %}
    {% if top_movies %}
    	<div class="card shadow-sm">
            <div class="card-body">
                <h2 class="h6 mb-3">Top 10 rating</h2>
                <ol class="list-group list-group-numbered list-group-flush">
                    {% for m in top_movies %}
                    	<li class="list-group-item d-flex justify-content-between align-items-start">
                            <div class="me-3">
                                <a href="{% url 'movie_detail' m.slug %}" class="text-decoration-none">
                                    {{ m.title }}
                                </a>
                                        {% if m.release_date %}
                                	        <span class="badge text-muted text-decoration-none">{{ m.release_date|date:"Y" }}</span>
                                        {% endif %}


                                {% if m.release_date %}
                                	<div class="small text-muted text-center">{{ m.release_date|date:"Y" }}</div>
                                {% endif %}
                            </div>
                            <span class="badge text-bg-primary rounded-pill">
                                ⭐ {{ m.avg_rating|floatformat:1 }}
                            </span>
                        </li>
                    {% endfor %}

                </ol>
            </div>
        </div>
    {% endif %}
    {% endcomment %}


    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
        <div>
            <h1 class="h3 mb-0">Filmy</h1>
            <small class="text-muted">Vyber si něco na večer</small>
        </div>

    {# search #}
        <form action="" method="get" class="d-flex gap-2 mt-3 mt-sm-0" role="search">
            <input type="search" class="form-control" name="q" value="{{ q }}" placeholder="Search Movies..." aria-label="Search">
            <button type="submit" class="btn btn-outline-light">Hledat</button>
        </form>
    </div>
    
    {% if movies %}
        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
            {% for movie in movies %}
                <div class="col">
                    <div class="card h-100 shadow-sm">

                        {# Poster / fallback #}
                        {% if movie.poster %}
                            {% if movie.poster.url %}
                            	<img src="{{ movie.poster.url }}"
                                     class="card-img-top"
                                     alt="{{ movie.title }}">
                                {% else %}
                                <img src="{{ movie.poster }}"
                                     class="card-img-top"
                                     alt="{{ movie.title }}">
                            {% endif %}
{#                            <img src="{{ movie.poster.url }}" class="card-img-top" alt="{{ movie.title }}">#}
                        {% else %}
{#                          <img src="{% static 'img/default_movie_poster.jpg' %}" class="card-img-top" alt="{{ movie.title }}">#}
                            <svg width="100px" height="100px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#a3a3a3"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M17 17L21 21M21 17L17 21M13 3H8.2C7.0799 3 6.51984 3 6.09202 3.21799C5.71569 3.40973 5.40973 3.71569 5.21799 4.09202C5 4.51984 5 5.0799 5 6.2V17.8C5 18.9201 5 19.4802 5.21799 19.908C5.40973 20.2843 5.71569 20.5903 6.09202 20.782C6.51984 21 7.0799 21 8.2 21H13M13 3L19 9M13 3V7.4C13 7.96005 13 8.24008 13.109 8.45399C13.2049 8.64215 13.3578 8.79513 13.546 8.89101C13.7599 9 14.0399 9 14.6 9H19M19 9V14" stroke="#878787" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
                        {% endif %}
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start gap-2">
                                <h2 class="h6 mb-1">{{ movie.title }}</h2>

                                {% if movie.avg_rating %}
                                <span class="badge text-bg-primary">⭐ {{ movie.avg_rating|floatformat:1 }}</span>
                                {% else %}
                                <span class="badge text-bg-secondary">--</span>
                                {% endif %}
                            </div>

                            <div class="mb-2">
                                {% if movie.release_date %}
                                	<small class="text-muted">{{ movie.release_date|date:"Y" }}</small>
                                {% endif %}
                            </div>

                            {# ggenres #}
                            <div class="mb-2">
                                {% for genre in movie.genres.all %}
                                	<span class="badge text-bg-dark me-1 mb-1">{{ genre.name }}</span>
                                {% empty %}
                                	<span class="badge text-muted small">No genres</span>
                                {% endfor %}
                            </div>

                            <p class="text-muted small flex-grow-1 mb-3">
                                {{ movie.description|slice:100|safe }}
                                    {% if movie.description|length > 100 %}
                                    	....
                                    {% endif %}
{#                                {{ movie.description }}#}
                            </p>
                            <div class="d-grid">
                                <a href="{% url 'movie_detail' movie.slug %}" class="btn btn-primary btn-sm">
                                    Detail
                                </a>
                            </div>
                        </div>

                    </div>
                </div>

            {% empty %}

            {% endfor %}

        </div>
    {% else %}
        <div class="alert alert-secondary">
            Žádné filmy nebyly nalezeny.
        </div>
    {% endif %}
    {% comment %}
    <div class="all-movies original">
        <h1>Movie list:</h1>
        <p>Filter BY: {{ sortform }}</p>
            <ul>
                {% for movie in movies %}
                    <li class="film-title-container">
{#                        {{ movie.title }} - {{ movie.release_date|date:"Y/m/d c b j l o W F z" }}#}
                        {{ movie.title }} - {{ movie.release_date|date:"Y"|pprint }}
                    </li>
{#                    <p>{{ movie.title }}</p>#}
{#                    <p>{{ movie.slug }}</p>#}
                    <p class="film-title-button">
                        <a class="button" href="{% url 'movie_detail' movie.slug %}">Detail</a> |
                        <a class="button" href="{% url 'add_review' movie.id %}">Add Review</a>
                    </p>
{#                        <a class="button" href="">Add Review</a>#}
                    {% empty %}
                        <h3>V DATABÁZI NEJSOU ŽÁDNÉ FILMY</h3>
        {#            <li><a href="{% url 'add_review' movie.id %}">add review</a></li>#}
                {% endfor %}
            </ul>
    </div>
{% endcomment %}

{% endblock %}